

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4.8. Steel Frame: Bayesian Calibration using TMCMC &mdash; Quantified Uncertainty with Optimization for the FEM  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
        <script src="../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
        <script src="../../../../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="5. Bugs &amp; Feature Requests" href="../../../bugs.html" />
    <link rel="prev" title="4.7. Two-Dimensional Truss: Global Sensitivity Analysis using SimCenterUQ Engine" href="../qfem-0009/README.html" />
<script src="https://cdn.jsdelivr.net/npm/vega@5.12.1"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@4.13.1"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.8.0"></script>
<style media="screen">.vega-actions a {margin-right: 5px;}</style>
<link href="../../../../../_static/css/bootstrap.css" rel="stylesheet">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #F2F2F2" >
          
<a href="https://simcenter.designsafe-ci.org/" style="margin-bottom: 0px;">
  <img src="../../../../../_static/img/SimCenter-Only.png" class="logo" alt="Org-Logo" />
</a>
<hr style="margin: 0px;">

  <a href="../../../../../index.html">



  
  <img src="../../../../../_static/quoFEM-LogoImageGrey-app.png" class="logo" alt="Logo"/>

</a>


  
  



<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about/quoFEM/aboutQUOFEM.html">1. About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../front-matter/ack.html">2. Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../front-matter/license.html">3. Copyright and License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../front-matter/glossary.html">4. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../front-matter/abbreviations.html">5. Abbreviations</a></li>
</ul>
<p class="caption"><span class="caption-text">User Manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../installation/desktop/installation.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/desktop/usage.html">2. User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting/desktop/troubleshooting.html">3. Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">4. Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../qfem-0001/README.html">4.1. Forward Propagation - OpenSees/Tcl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qfem-0002/README.html">4.2. Forward Propagation - OpenSeesPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qfem-0003/README.html">4.3. Reliability Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qfem-0004/README.html">4.4. Sensitivity Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qfem-0005/README.html">4.5. Basic modeling with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qfem-0008/README.html">4.6. Bayesian Calibration - Steel Frame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qfem-0009/README.html">4.7. Two-Dimensional Truss: Global Sensitivity Analysis using SimCenterUQ Engine</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.8. Steel Frame: Bayesian Calibration using TMCMC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#outline">4.8.1. Outline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#problem-description">4.8.2. Problem description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-required">4.8.3. Files required</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solving-the-problem-using-quofem">4.8.4. Solving the problem using quoFEM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../bugs.html">5. Bugs &amp; Feature Requests</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../technical_manual/desktop/technical_manual.html">1. Technical Manual</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_manual/how_to_build/desktop/how_to_build.html">1. How to Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_manual/architecture/desktop/architecture.html">2. Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_manual/how_to_extend/desktop/how_to_extend.html">3. How to Extend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_manual/verification/desktop/verification.html">4. Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_manual/coding_style/desktop/coding_style.html">5. Coding Style</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Quantified Uncertainty with Optimization for the FEM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../examples.html"><span class="section-number">4. </span>Examples</a> &raquo;</li>
        
      <li><span class="section-number">4.8. </span>Steel Frame: Bayesian Calibration using TMCMC</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../_sources/common/user_manual/examples/desktop/qfem-0014/README.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="steel-frame-bayesian-calibration-using-tmcmc">
<h1><span class="section-number">4.8. </span>Steel Frame: Bayesian Calibration using TMCMC<a class="headerlink" href="#steel-frame-bayesian-calibration-using-tmcmc" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Problem files</p></td>
<td><p><a class="reference external" href="https://github.com/NHERI-SimCenter/quoFEM/tree/master/Examples//qfem-0014//">qfem-0014/</a></p></td>
</tr>
</tbody>
</table>
<div class="section" id="outline">
<h2><span class="section-number">4.8.1. </span>Outline<a class="headerlink" href="#outline" title="Permalink to this headline">¶</a></h2>
<p>In this example, Bayesian estimation is used to estimate the lateral story
stiffnesses of the two stories of a simple steel frame, given data about
its mode shapes and frequencies. The transitional Markov chain Monte Carlo
algorithm is used to obtain samples from the posterior probability distribution
of the lateral story stiffnesses.</p>
</div>
<div class="section" id="problem-description">
<h2><span class="section-number">4.8.2. </span>Problem description<a class="headerlink" href="#problem-description" title="Permalink to this headline">¶</a></h2>
<p>Provided by Professor Joel Conte and his doctoral students Maitreya
Kurumbhati and Mukesh Ramancha from UC San Diego, this example looks at
the following simplified finite element model of a steel building.</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="../../../../../_images/qfem-0014.png"><img alt="../../../../../_images/qfem-0014.png" src="../../../../../_images/qfem-0014.png" style="width: 400px;" /></a>
</div>
<p>Each floor slab of the building is made of composite metal deck and is
supported on four steel columns. The story heights are measured at
<span class="math notranslate nohighlight">\(10'\)</span> and in plan the side lengths measure <span class="math notranslate nohighlight">\(33'-4&quot;\)</span> by
<span class="math notranslate nohighlight">\(30'\)</span>. Properties of the steel columns are taken deterministically
with an elastic modulus of <span class="math notranslate nohighlight">\(29,000 \ \mathrm{ksi}\)</span>, area of
<span class="math notranslate nohighlight">\(110 \ \mathrm{in}^2\)</span>, and principal moment of inertial
(<span class="math notranslate nohighlight">\(I_{yy}\)</span>) of <span class="math notranslate nohighlight">\(1190 \ \mathrm{ in}^4\)</span>. The story stiffnesses
<code class="docutils literal notranslate"><span class="pre">k1</span></code> and <code class="docutils literal notranslate"><span class="pre">k2</span></code> are both equal to <span class="math notranslate nohighlight">\(958.61 \ \mathrm{kips/in}\)</span>.</p>
<p>For modelling purposes, the four columns are assumed fixed at the base and the beams connecting
them are assumed to be rigid. From eigenvalue analysis, the first two vibration periods of the
structure are determined to be <span class="math notranslate nohighlight">\(0.19 \ \mathrm{sec}\)</span> and <span class="math notranslate nohighlight">\(0.09 \ \mathrm{sec}\)</span>.
The first eigenvalue <span class="math notranslate nohighlight">\(\lambda_{1}\)</span> is <span class="math notranslate nohighlight">\(1084.06 \ \mathrm{rad/{s^2}}\)</span> and the second
component of the first eigenvector <span class="math notranslate nohighlight">\(\phi_{12}\)</span> is <span class="math notranslate nohighlight">\(1.41 \ \mathrm{inch}\)</span>, where the
eigenvector is normalized so that the first component <span class="math notranslate nohighlight">\(\phi_{11} = 1\)</span>.
Using these properties, the following set of mode shapes and frequencies
are generated by applying random perturbations to the analytic modal
properties in order to simulate field data that might be obtained using
a method for structural system identification:</p>
<div class="math notranslate nohighlight" id="equation-common-user-manual-examples-desktop-qfem-0014-readme-0">
<span class="eqno">(4.8.1)<a class="headerlink" href="#equation-common-user-manual-examples-desktop-qfem-0014-readme-0" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{array}{l}
\lambda_{1}^{(1)}=1025.21, \quad &amp;\lambda_{1}^{(2)}=1138.11, \quad &amp;\lambda_{1}^{(3)}=1099.39, \quad &amp;\lambda_{1}^{(4)}=1002.41, \quad &amp;\lambda_{1}^{(5)}=1052.69 \\
\phi_{12}^{(1)}=1.53, \quad &amp;\phi_{12}^{(2)}=1.24, \quad &amp;\phi_{12}^{(3)}=1.38, \quad &amp;\phi_{12}^{(4)}=1.50, \quad &amp;\phi_{12}^{(5)}=1.35
\end{array}\end{split}\]</div>
<p>In this example, it is assumed that the story stiffnesses for the first and second story (<code class="docutils literal notranslate"><span class="pre">k1</span></code> and <code class="docutils literal notranslate"><span class="pre">k2</span></code> respectively) are unknown. The goal is to use the simulated data of eigenvalue and eigenvector measurements to obtain the posterior probability distribution of the story stiffnesses by Bayesian calibration. We will employ the Transitional Markov Chain Monte Carlo (TMCMC) algorithm, which is also known as Sequential Monte Carlo, to sample from the posterior joint probability distribution of <code class="docutils literal notranslate"><span class="pre">k1</span></code> and <code class="docutils literal notranslate"><span class="pre">k2</span></code>.</p>
<p>We define the following prior probability distributions for the unknown quantities of interest:</p>
<ol class="arabic simple">
<li><p>First story stiffness, <code class="docutils literal notranslate"><span class="pre">k1</span></code>: <strong>Uniform</strong>
distribution with a lower bound <span class="math notranslate nohighlight">\((L_B)\)</span> of <span class="math notranslate nohighlight">\(766.89 \ \mathrm{kips/in}\)</span>, and an upper bound <span class="math notranslate nohighlight">\((U_B)\)</span>
of <span class="math notranslate nohighlight">\(2108.94 \ \mathrm{kips/in}\)</span>,</p></li>
<li><p>Second story stiffness, <code class="docutils literal notranslate"><span class="pre">k2</span></code>: <strong>Uniform</strong>
distribution with a lower bound <span class="math notranslate nohighlight">\((L_B)\)</span> of <span class="math notranslate nohighlight">\(383.44 \ \mathrm{kips/in}\)</span>, and an upper bound <span class="math notranslate nohighlight">\((U_B)\)</span>
of <span class="math notranslate nohighlight">\(1150.33 \ \mathrm{kips/in}\)</span>.</p></li>
</ol>
<p>A Gaussian likelihood model is employed. This is done by assuming that the error between the finite element prediction of the modal properties and the simulated measurement data follows a bivariate Normal/Gaussian distribution with independent components. Here, the standard deviation of the error is assumed to be known, and equal to <span class="math notranslate nohighlight">\(5\%\)</span> of the true eigenvalue and eigenvector values. The components of the error vector are assumed to be statistically independent and identically distributed.</p>
</div>
<div class="section" id="files-required">
<h2><span class="section-number">4.8.3. </span>Files required<a class="headerlink" href="#files-required" title="Permalink to this headline">¶</a></h2>
<p>The exercise requires two script files - an OpenSees script file which builds the finite element model and conducts the analysis, and a Python script file which post-processes the output from the finite element analysis. The user should download these file and place it in a <em>new</em> folder. The post-processing script calculates the log-likelihood that the input values of the story stiffness produced the set of measurement data.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/NHERI-SimCenter/quoFEM/tree/master/Examples//qfem-0014/src/model.tcl">model.tcl</a></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#Generalized eigenValue Problem

# units: in, kips

wipe

#model builder
model BasicBuilder -ndm 2 -ndf 3	

#input

#masses
#total mass of story distributed to two nodes
set m1 [expr 0.52/2.];
set m2 [expr 0.26/2.];

#number of modes  
set numModes 2

#material properties

#column
set Ac 110.0 
#input from the algorithm

#pset k1 958.61
#pset k2 958.61

set E 29000.0 
#beam
set Ib 10e+12 
set Ab 10e+12 

#geometry
set L 400. 
set h  120. 

#nodes
node 1   0.  0. ;
node 2   $L  0. ;
node 3   0.  $h ;
node 4   $L  $h ;
node 5   0.  [expr 2*$h];
node 6   $L  [expr 2*$h];

#fixity of base
fix 1 1 1 1;
fix 2 1 1 1;

#vertical translation constraint
fix 3 0 1 0;
fix 5 0 1 0;
fix 4 0 1 0;
fix 6 0 1 0;

#equalDoF constraints for horizontal DoF
equalDOF 3 4 1
equalDOF 5 6 1 

# assign mass
mass 3 $m1 0. 0. ;
mass 4 $m1 0. 0. ;
mass 5 $m2 0. 0. ;
mass 6 $m2 0. 0. ;


# define geometric transformation:
set TransfTag 1;
geomTransf Linear $TransfTag ;

# define elements:
# columns
element elasticBeamColumn 1 1 3 $Ac $E  [expr 2.*$k1*(pow($h,3.))/48./$E] $TransfTag; #story stiffness k = 48*E*Icolumn/h^3
element elasticBeamColumn 2 3 5 $Ac $E  [expr 2.*$k2*(pow($h,3.))/48./$E] $TransfTag;
element elasticBeamColumn 3 2 4 $Ac $E  [expr 2.*$k1*(pow($h,3.))/48./$E] $TransfTag;
element elasticBeamColumn 4 4 6 $Ac $E  [expr 2.*$k2*(pow($h,3.))/48./$E] $TransfTag;
# beams
element elasticBeamColumn 5 3 4 $Ab $E  $Ib $TransfTag; #beam flexurally rigid mimicing a rigid diaghraphm
element elasticBeamColumn 6 5 6 $Ab $E  $Ib $TransfTag;

# eigenValue
set eigenValues [eigen -fullGenLapack $numModes]

# eigenVector and normalize
set eig11 [nodeEigenvector 3 1 1];
set eig12 [nodeEigenvector 5 1 1];

set eig21 [nodeEigenvector 3 2 1];
set eig22 [nodeEigenvector 5 2 1];

set Eig1 {};
lappend Eig1 [expr $eig11/$eig11];
lappend Eig1 [expr $eig12/$eig11];

set Eig2 {};
lappend Eig2 [expr $eig21/$eig21];
lappend Eig2 [expr $eig22/$eig21];


# print first eigenValue and first eigenVector
set OutputFile [open &quot;results.out&quot; w]
puts $OutputFile &quot;[lindex $eigenValues 0] [lindex $Eig1 1]&quot;
close $OutputFile
wipe
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tcl script creates a file called <code class="docutils literal notranslate"><span class="pre">results.out</span></code> when it runs. This file contains the first eigenvalue and the second component of the first eigenvector obtained from finite element analysis of the structure.</p>
</div>
<ol class="arabic simple" start="2">
<li><p><a class="reference external" href="https://github.com/NHERI-SimCenter/quoFEM/tree/master/Examples//qfem-0014/src/postProcessing.py">postProcessing.py</a></p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">authors: Mukesh Kumar Ramancha, Maitreya Manoj Kurumbhati, and Prof. J.P. Conte </span>
<span class="sd">affiliation: University of California, San Diego</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#import standard python modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">runFEM</span> <span class="kn">import</span> <span class="n">runFEM</span>
<span class="c1"># from runFEM import ParameterName</span>
<span class="kn">from</span> <span class="nn">generateData</span> <span class="kn">import</span> <span class="n">data</span>

<span class="c1">#%%</span>

<span class="c1"># normalize data (IMPORTANT for TMCMC)</span>
<span class="n">normalizeData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">normalizeData</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="c1"># noise in each channel</span>
<span class="n">sig_channels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.05</span><span class="p">])</span> <span class="c1">#Ny x 1,  Ny = number of measurement channels </span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sig_channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1079.88</span><span class="p">,</span><span class="n">sig_channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.414</span><span class="p">])</span> <span class="c1"># array of size: Ny</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span><span class="o">/</span><span class="n">normalizeData</span>

<span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="n">ParticleNum</span><span class="p">,</span><span class="n">par</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">resultsLocation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; this function computes the log-likelihood for parameter value: par &quot;&quot;&quot;</span>
     
    <span class="c1"># num of data point: N, num of measurement channels: Ny</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">ParameterName</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span>
    
    <span class="c1"># FE predicted response</span>
    <span class="n">runFEM</span><span class="p">(</span><span class="n">ParticleNum</span><span class="p">,</span><span class="n">par</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">ParameterName</span><span class="p">)],</span> <span class="n">variables</span><span class="p">,</span> <span class="n">resultsLocation</span><span class="p">)</span>
    
    <span class="n">FEpred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;results.out&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">normalizeData</span>
    
    <span class="n">FEpred</span> <span class="o">=</span> <span class="n">FEpred</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    
    <span class="c1"># CASE I &amp; II: Known/Estimate Noise</span>
    <span class="c1"># noise covariance matrix</span>
    <span class="c1">#sig = par[-Ny:] # --&gt; enable for CASE II</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">sig</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">logdetE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
    <span class="n">Einv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
    <span class="c1"># log-likelihood</span>
    <span class="n">LL</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">N</span><span class="o">*</span><span class="n">Ny</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">N</span><span class="o">*</span><span class="n">logdetE</span> <span class="o">+</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span> <span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">FEpred</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Einv</span> <span class="o">@</span> <span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">FEpred</span><span class="p">)))</span>
    
    <span class="c1"># CASE III: Integrate Noise Out</span>
    <span class="c1"># using Jeffrey prior</span>
    <span class="c1">#LL = -0.5*N*Ny*np.log(2*np.pi) + sum(-np.log(np.diag((data.T-FEpred.T).T @ (data.T-FEpred.T))))</span>
    
    <span class="k">return</span> <span class="n">LL</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not place the files in your root, downloads, or desktop folder as when the application runs it will copy the contents on the directories and subdirectories containing these files multiple times. If you are like me, your root, Downloads or Documents folders contains and awful lot of files.</p>
</div>
</div>
<div class="section" id="solving-the-problem-using-quofem">
<h2><span class="section-number">4.8.4. </span>Solving the problem using quoFEM<a class="headerlink" href="#solving-the-problem-using-quofem" title="Permalink to this headline">¶</a></h2>
<p>The steps involved are as follows:</p>
<ol class="arabic simple">
<li><p>Start the application and the <strong>UQ</strong> panel will be highlighted. In the <strong>UQ Engine</strong> drop down menu, select the <strong>UCSD_UQ</strong> engine. In the <strong>Method</strong> category drop down menu the <strong>Transitional Markov chain Monte Carlo</strong> option will be highlighted. In the <strong>Log Likelihood Script</strong> field, enter the path to the script which computes the log-likelihood (i.e., the file called <code class="docutils literal notranslate"><span class="pre">postProcessing.py</span></code> in this example), or select <strong>Choose</strong> and navigate to the file. Enter the number of samples desired to be drawn from the posterior distribution in the <strong># Samples</strong> field.</p></li>
</ol>
<div class="align-center figure">
<img alt="../../../../../_images/quo-14-UQ.png" src="../../../../../_images/quo-14-UQ.png" />
</div>
<ol class="arabic simple" start="2">
<li><p>Next select the <strong>FEM</strong> panel from the input panel selection. This will default to the <strong>OpenSees</strong> FEM engine. In the <strong>Input Script</strong> field, enter the path to the <code class="docutils literal notranslate"><span class="pre">model.tcl</span></code> file or select <strong>Choose</strong> and navigate to the file.</p></li>
</ol>
<div class="align-center figure">
<img alt="../../../../../_images/quo-14-FEM.png" src="../../../../../_images/quo-14-FEM.png" />
</div>
<ol class="arabic simple" start="3">
<li><p>Next select the <strong>RV</strong> tab from the input panel. This panel should be pre-populated with two random variables named <code class="docutils literal notranslate"><span class="pre">k1</span></code> snd <code class="docutils literal notranslate"><span class="pre">k2</span></code>. If not, press the <strong>Add</strong> button twice to create two fields to define the input random variables. Enter the same variable names (<code class="docutils literal notranslate"><span class="pre">k1</span></code> and <code class="docutils literal notranslate"><span class="pre">k2</span></code>), as required in the <code class="docutils literal notranslate"><span class="pre">model.tcl</span></code> script.</p></li>
</ol>
<p>For each variable, specify the prior probability distribution - from the <strong>Distribution</strong> drop down menu, select <strong>Uniform</strong> and then provide the lower bounds and upper bounds shown in the figure below.</p>
<div class="align-center figure">
<img alt="../../../../../_images/quo-14-RV.png" src="../../../../../_images/quo-14-RV.png" />
</div>
<ol class="arabic simple" start="4">
<li><p>The <strong>QoI</strong> panel can be left blank for this example and for problems using the <strong>UCSD_UQ</strong> engine.</p></li>
<li><p>Next click on the <strong>Run</strong> button. This will cause the backend application to launch the <strong>UCSD_UQ</strong> engine, which performs Bayesian calibration using the TMCMC algorithm. When done the <strong>RES</strong> tab will be selected and the results will be displayed as shown in the figure below. The results show the first four moments of the posterior marginal probability distribution of <code class="docutils literal notranslate"><span class="pre">k1</span></code> and <code class="docutils literal notranslate"><span class="pre">k2</span></code>.</p></li>
</ol>
<div class="align-center figure">
<img alt="../../../../../_images/quo-14-RES-Summary.png" src="../../../../../_images/quo-14-RES-Summary.png" />
</div>
<p>If the user selects the <strong>Data Values</strong> tab in the results panel, they will be presented with both a graphical plot and a tabular listing of the data.</p>
<div class="align-center figure">
<img alt="../../../../../_images/quo-14-RES-DataValues1.png" src="../../../../../_images/quo-14-RES-DataValues1.png" />
</div>
<p>Various views of the graphical display can be obtained by left and right clicking in the columns of the tabular data.</p>
<div class="align-center figure">
<img alt="../../../../../_images/quo-14-RES-DataValues2.png" src="../../../../../_images/quo-14-RES-DataValues2.png" />
</div>
<p>If a singular column of the tabular data is pressed with both right and left buttons a histogram and CDF will be displayed, as shown in figure below.</p>
<div class="align-center figure">
<img alt="../../../../../_images/quo-14-RES-DataValues3.png" src="../../../../../_images/quo-14-RES-DataValues3.png" />
</div>
<div class="align-center figure">
<img alt="../../../../../_images/quo-14-RES-DataValues4.png" src="../../../../../_images/quo-14-RES-DataValues4.png" />
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018-2020, The Regents of the University of California.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-158130480-4', 'auto');
    
    ga('send', 'pageview');
    </script>

    
    

  <style>
         .wy-nav-content { max-width: none; }
  </style>

<script>
    let selectedFilters = [];
    const images  = document.getElementsByClassName("gallery-item");
    const filters = [...document.querySelectorAll('.filter select')];
    const toggles = [...document.querySelectorAll('.filter input')];

    var show = function (elem) {
        elem.style.display = 'block';
    };
    var hide = function (elem) {
        elem.style.display = 'none';
    };
    var toggleFilter =  function(el,elid) {
        const filter = document.getElementById(elid);
        filter.disabled = !el.checked;
       
        if ("createEvent" in document) {
            var evt = document.createEvent("HTMLEvents");
            evt.initEvent("change", false, true);
            filter.dispatchEvent(evt);
        }
        else
            filter.fireEvent("change");
    };
    
    for (const filter of filters) {
        filter.addEventListener('change', function(event) {
            selectedFilters = filters.map(filter => filter.disabled ? '' : filter.value).filter(Boolean);
            console.log(selectedFilters);
            for (const image of images) {
                if (selectedFilters.every(filter => image.classList.contains(filter))) {
                    show(image);
                }
                else {hide(image)};
            };
        })
    };
</script>


</body>
</html>